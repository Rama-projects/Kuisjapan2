<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>KUIS JEPANG RAMA - PRO</title>
<style>
  html, body { margin: 0; padding: 0; background-color: #121212; color: #eee; font-family: sans-serif; }
  body { display: flex; justify-content: center; min-height: 100vh; }
  #app { width: 100vw; max-width: 420px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; position: relative; }
  
  #backBtn { position: absolute; top: 15px; left: 15px; font-size: 28px; background: none; border: none; color: #ff5722; cursor: pointer; display: none; z-index: 1000; }
  
  /* Tombol Mute Baru - Letak di Pojok Kanan Atas */
  #muteToggle { position: absolute; top: 15px; right: 15px; font-size: 24px; background: #222; border: 1px solid #444; color: #ffb74d; cursor: pointer; padding: 5px; border-radius: 50%; width: 45px; height: 45px; display: none; z-index: 1000; align-items: center; justify-content: center; }

  .menu-container { display: none; flex-direction: column; gap: 15px; align-items: center; width: 100%; padding-top: 50px; }
  #headerGrid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
  
  .mainBtn { background: #ff5722; border-radius: 18px; padding: 18px; font-weight: bold; color: white; width: 95%; border: none; cursor: pointer; font-size: 15px; text-transform: uppercase; box-shadow: 0 4px 0 #bf360c; transition: 0.1s; }
  .mainBtn:active { transform: translateY(2px); box-shadow: 0 2px 0 #bf360c; }
  .iroBtn { background: #2196f3; box-shadow: 0 4px 0 #1565c0; }
  .babBtn { background: #1e1e1e; border-radius: 12px; padding: 10px; color: #eee; border: 1px solid #333; cursor: pointer; min-width: 85px; font-size: 13px; }

  #wordBox { display: none; flex-direction: column; align-items: center; text-align: center; flex-grow: 1; justify-content: center; }
  #kanji { font-size: 22px; color: #888; margin-bottom: 5px; min-height: 26px; }
  #kanaWrap { display: flex; align-items: center; gap: 15px; }
  #kana { font-size: 34px; color: #ff5722; font-weight: bold; }
  .speakerBtn { background: none; border: none; font-size: 30px; cursor: pointer; color: #ffb74d; }

  #options { display: none; flex-direction: column; gap: 12px; width: 100%; margin: 20px 0; }
  .optBtn { background: #252525; border: 1px solid #333; padding: 18px; border-radius: 15px; color: white; font-size: 18px; cursor: pointer; }
  .optBtn.correct { background: #4caf50 !important; border-color: #4caf50; }
  .optBtn.wrong { background: #f44336 !important; border-color: #f44336; }

  #inputContainer { display: none; width: 100%; flex-direction: column; gap: 10px; margin: 20px 0; }
  #userAnswer { width: 100%; padding: 18px; border-radius: 15px; border: 2px solid #333; background: #252525; color: white; font-size: 18px; text-align: center; box-sizing: border-box; }
  #wrongMsg { display: none; color: #ffb74d; font-size: 14px; text-align: center; background: rgba(244, 67, 54, 0.1); padding: 12px; border-radius: 10px; border: 1px solid #f44336; line-height: 1.5; }

  #resultPage { display: none; text-align: center; width: 100%; }
  .score-circle { width: 120px; height: 120px; border-radius: 50%; border: 6px solid #ff5722; display: flex; justify-content: center; align-items: center; margin: 20px auto; font-size: 32px; font-weight: bold; color: #ff5722;}
  #reviewBox { width: 100%; text-align: left; background: #1a1a1a; padding: 15px; border-radius: 12px; box-sizing: border-box; margin-bottom: 20px; max-height: 300px; overflow-y: auto; }
  .review-item { border-bottom: 1px solid #333; padding: 10px 0; font-size: 14px; }
</style>
</head>
<body>

<div id="app">
  <button id="backBtn" onclick="goBack()">‚Üê</button>
  <button id="muteToggle" onclick="toggleMute()">üîä</button>

  <div id="mainMenu" class="menu-container">
    <h2 style="color: #ff5722;">Êó•Êú¨Ë™û„ÇØ„Ç§„Ç∫</h2>
    <button class="mainBtn" onclick="showMinnaMenu()">MINNA NO NIHONGO</button>
    <button class="mainBtn iroBtn" onclick="showIrodoriMenu()">IRODORI</button>
  </div>

  <div id="minnaMenu" class="menu-container">
    <button class="mainBtn" onclick="showBagian(1)">BAGIAN 1 (1-25)</button>
    <button class="mainBtn" onclick="showBagian(2)">BAGIAN 2 (26-50)</button>
    <button class="mainBtn" style="background:#333; border:2px solid #ff5722;" onclick="showRefMenu()">REFERENSI</button>
  </div>

  <div id="irodoriMenu" class="menu-container">
    <h2 style="color:#2196f3;">IRODORI</h2>
    <button class="mainBtn iroBtn" onclick="startIrodoriKanji()">KANJI</button>
  </div>

  <div id="dynamicMenu" class="menu-container">
    <h2 id="dynamicTitle">Pilih Bab</h2>
    <div id="headerGrid"></div>
  </div>

  <div id="modeMenu" class="menu-container">
    <h2 style="color: #ffb74d;">Pilih Mode</h2>
    <p id="modeInfo" style="color:#888;"></p>
    <button class="mainBtn" onclick="setQuizMode('jp-id')">JEPANG ‚ûî INDO</button>
    <button class="mainBtn iroBtn" onclick="setQuizMode('id-jp')">INDO ‚ûî JEPANG</button>
  </div>

  <div id="wordBox">
    <div id="kanji"></div>
    <div id="kanaWrap">
        <div id="kana"></div>
        <button class="speakerBtn" onclick="playAudio()">üîä</button>
    </div>
    <div id="instruksi" style="font-size:13px; color:#ffb74d; font-style:italic; margin-top:10px;"></div>
  </div>

  <div id="comboSection" style="display:none; text-align:center; margin-bottom: 10px; color:#4caf50;">Combo: <span id="flowerCount">0</span></div>
  
  <div id="options"></div>

  <div id="inputContainer">
    <input type="text" id="userAnswer" placeholder="Ketik jawabannya..." autocomplete="off">
    <div id="wrongMsg"></div>
    <button class="mainBtn" style="margin-top:10px;" onclick="checkInputAnswer()">KIRIM JAWABAN</button>
  </div>

  <div id="resultPage" class="menu-container">
    <h2>HASIL KUIS</h2>
    <div class="score-circle" id="finalScore">0%</div>
    <div id="reviewBox"></div>
    <button id="nextChunkBtn" class="mainBtn" style="display:none;">LANJUT</button>
    <button class="mainBtn" style="background:#555; margin-top:10px;" onclick="goBack()">MENU</button>
  </div>
</div>

<script src="data_minna.js"></script>
<script src="data_referensi.js"></script>
<script src="data_irodori.js"></script>

<script>
  let masterPool = [], currentQuestions = [], currentIndex = 0;
  let correctCount = 0, combo = 0, quizMode = 'jp-id', currentAnswer = "";
  let wrongList = [], activeView = 'main', currentLabel = '', selectedData = null;
  
  // Status Mute Global
  let isMuted = false;

  function hideAll() {
    ['mainMenu','minnaMenu','irodoriMenu','dynamicMenu','modeMenu','wordBox','options','comboSection','resultPage','inputContainer']
    .forEach(id => document.getElementById(id).style.display = 'none');
    document.getElementById('muteToggle').style.display = 'none'; // Sembunyikan mute saat ganti menu
  }

  function showMainMenu() { hideAll(); document.getElementById('mainMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'none'; activeView = 'main'; }
  function showMinnaMenu() { hideAll(); document.getElementById('minnaMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'minna'; }
  function showIrodoriMenu() { hideAll(); document.getElementById('irodoriMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'irodori'; }

  function showGridMenu(title, type, start, end) {
    hideAll();
    const grid = document.getElementById('headerGrid');
    document.getElementById('dynamicTitle').innerText = title;
    grid.innerHTML = '';
    document.getElementById('dynamicMenu').style.display = 'flex';
    document.getElementById('backBtn').style.display = 'block';
    activeView = type;
    for(let i=start; i<=end; i++) {
        let b = document.createElement('button');
        b.className = 'babBtn'; b.innerText = 'Bab ' + i;
        b.onclick = () => { selectedData = type === 'ref' ? referensiData[i] : babData[i]; currentLabel = 'Bab ' + i; showModeMenu(); };
        grid.appendChild(b);
    }
  }

  function showBagian(n) { showGridMenu("Minna No Nihongo", 'bagian_'+n, n===1?1:26, n===1?25:50); }
  function showRefMenu() { showGridMenu("Referensi", "ref", 1, 50); }
  function showModeMenu() { hideAll(); document.getElementById('modeMenu').style.display = 'flex'; document.getElementById('modeInfo').innerText = currentLabel; activeView = 'mode'; }
  function setQuizMode(mode) { quizMode = mode; startQuiz(); }
  function startIrodoriKanji() { selectedData = irodoriKanjiData; currentLabel = "Irodori Kanji"; showModeMenu(); }

  function startQuiz() {
    masterPool = [...selectedData].sort(() => Math.random() - 0.5);
    nextChunk();
  }

  function nextChunk() {
    currentQuestions = masterPool.splice(0, 10);
    currentIndex = 0; correctCount = 0; combo = 0; wrongList = [];
    activeView = 'quiz';
    renderQuestion();
  }

  // Fungsi Toggle Mute
  function toggleMute() {
    isMuted = !isMuted;
    const btn = document.getElementById('muteToggle');
    btn.innerText = isMuted ? "üîá" : "üîä";
    if (isMuted) window.speechSynthesis.cancel();
  }

  function playAudio() {
    if (isMuted) return; // Tidak bunyi jika muted
    const q = currentQuestions[currentIndex];
    if (!q) return;
    window.speechSynthesis.cancel(); // Bersihkan antrean suara
    const utterance = new SpeechSynthesisUtterance(q.kana || q.kanji);
    utterance.lang = 'ja-JP'; utterance.rate = 0.7;
    window.speechSynthesis.speak(utterance);
  }

  document.getElementById('userAnswer').addEventListener('keypress', (e) => { if(e.key==='Enter') checkInputAnswer(); });

  function renderQuestion() {
    if(currentIndex >= currentQuestions.length) { showResult(); return; }
    hideAll();
    const q = currentQuestions[currentIndex];
    const optBox = document.getElementById('options');
    const inputCont = document.getElementById('inputContainer');
    const inputField = document.getElementById('userAnswer');
    
    document.getElementById('wordBox').style.display = 'flex';
    document.getElementById('comboSection').style.display = 'block';
    document.getElementById('muteToggle').style.display = 'flex'; // Tampilkan mute saat kuis
    document.getElementById('backBtn').style.display = 'block';
    document.getElementById('instruksi').innerText = q.instruksi || "Pilih/Ketik jawaban";
    document.getElementById('wrongMsg').style.display = "none";
    inputField.value = ""; inputField.style.borderColor = "#333";
    optBox.innerHTML = '';

    if (quizMode === 'jp-id') {
        document.getElementById('kanji').innerText = q.kanji || "";
        document.getElementById('kana').innerText = q.kana || "";
        currentAnswer = q.correct;
        setTimeout(playAudio, 400); 
    } else {
        document.getElementById('kanji').innerText = ""; 
        document.getElementById('kana').innerText = q.correct; 
        currentAnswer = q.kana;
        // JANGAN playAudio di sini agar tidak bocor jawabannya
    }

    const isTyping = Math.random() > 0.5;
    if(isTyping) {
        inputCont.style.display = 'flex'; inputField.focus();
    } else {
        optBox.style.display = 'flex';
        let choices = (quizMode === 'jp-id') ? [...q.answers] : [q.kana, ...selectedData.filter(x=>x.kana!==q.kana).sort(()=>Math.random()-0.5).slice(0,3).map(x=>x.kana)];
        choices.sort(()=>Math.random()-0.5).forEach(txt => {
            let b = document.createElement('button'); b.className = 'optBtn'; b.innerText = txt;
            b.onclick = () => { if(quizMode==='id-jp') playAudio(); processAnswer(txt === currentAnswer, b); };
            optBox.appendChild(b);
        });
    }
    document.getElementById('flowerCount').innerText = combo;
  }

  function checkInputAnswer() {
    const q = currentQuestions[currentIndex];
    const userVal = document.getElementById('userAnswer').value.trim();
    const msg = document.getElementById('wrongMsg');
    const inputField = document.getElementById('userAnswer');
    
    let isCorrect = (quizMode === 'jp-id') ? (userVal.toLowerCase() === q.correct.toLowerCase()) : (userVal === q.kanji || userVal === q.kana);

    if(isCorrect) {
        inputField.style.borderColor = "#4caf50";
        if(quizMode==='id-jp') playAudio();
        processAnswer(true);
    } else {
        inputField.style.borderColor = "#f44336";
        msg.style.display = 'block';
        msg.innerText = (quizMode==='jp-id') ? `SALAH!\nJawaban: ${q.correct}` : `SALAH!\nJawaban: ${q.kanji || ''} (${q.kana})`;
        if(quizMode==='id-jp') playAudio(); // Bunyikan jawaban yang benar
        setTimeout(() => processAnswer(false), 6000); 
    }
  }

  function processAnswer(isCorrect, btn = null) {
    if(isCorrect) {
        if(btn) btn.classList.add('correct');
        correctCount++; combo++;
        setTimeout(() => { currentIndex++; renderQuestion(); }, 700);
    } else {
        if(btn) {
            btn.classList.add('wrong');
            wrongList.push(currentQuestions[currentIndex]); combo = 0;
            Array.from(document.getElementById('options').children).forEach(b => { if(b.innerText === currentAnswer) b.classList.add('correct'); });
            setTimeout(() => { currentIndex++; renderQuestion(); }, 3000);
        } else {
            wrongList.push(currentQuestions[currentIndex]); combo = 0;
            currentIndex++; renderQuestion();
        }
    }
  }

  function showResult() {
    hideAll();
    const resPage = document.getElementById('resultPage');
    resPage.style.display = 'flex';
    document.getElementById('backBtn').style.display = 'block';
    document.getElementById('finalScore').innerText = Math.round((correctCount/currentQuestions.length)*100) + "%";
    
    const rBox = document.getElementById('reviewBox');
    rBox.innerHTML = '<b>REVIEW KESALAHAN:</b><br><br>';
    if(wrongList.length === 0) rBox.innerHTML += '<span style="color:#4caf50">Sempurna! Kamu hebat!</span>';
    else wrongList.forEach(w => { rBox.innerHTML += `<div class="review-item"><b>${w.kanji || ''} ${w.kana}</b><br>${w.correct}</div>`; });

    const btnLanjut = document.getElementById('nextChunkBtn');
    if (masterPool.length > 0) { btnLanjut.style.display = 'block'; btnLanjut.onclick = nextChunk; }
    else btnLanjut.style.display = 'none';
  }

  function goBack() {
    if (activeView === 'quiz' || activeView === 'result') showModeMenu();
    else if (activeView === 'mode') showMinnaMenu();
    else if (activeView.startsWith('bagian') || activeView === 'ref') showMinnaMenu();
    else showMainMenu();
  }

  window.onload = showMainMenu;
</script>
</body>
</html>
