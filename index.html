<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>KUIS BAHASA JEPANG RAMA</title>
<style>
  html, body { margin: 0; padding: 0; background-color: #121212; color: #eee; font-family: sans-serif; }
  body { display: flex; justify-content: center; min-height: 100vh; overflow-x: hidden; }
  #app { width: 100vw; max-width: 420px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; position: relative; }
  
  #backBtn { position: absolute; top: 15px; left: 15px; font-size: 28px; background: none; border: none; color: #ff5722; cursor: pointer; display: none; z-index: 1000; padding: 5px; line-height: 1; }
  #muteBtn { position: absolute; top: 15px; right: 15px; font-size: 24px; background: none; border: none; color: #ffb74d; cursor: pointer; z-index: 1000; padding: 5px; line-height: 1; }
  
  #quizHeader { text-align: center; margin-bottom: 15px; }
  #quizInfo { font-size: 10px; color: #ff5722; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; border: 1px solid #ff5722; padding: 2px 8px; border-radius: 4px; display: inline-block; }
  #instruksi { font-size: 13px; color: #ffb74d; margin-top: 8px; font-style: italic; }

  .menu-container { display: none; flex-direction: column; gap: 15px; align-items: center; width: 100%; padding-top: 50px; }
  #headerGrid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
  
  .mainBtn { background: #ff5722; border-radius: 18px; padding: 18px; font-weight: bold; color: white; width: 95%; border: none; cursor: pointer; font-size: 15px; text-transform: uppercase; box-shadow: 0 4px 0 #bf360c; transition: 0.1s; }
  .mainBtn:active { transform: translateY(2px); box-shadow: 0 2px 0 #bf360c; }
  
  .iroBtn { background: #2196f3; box-shadow: 0 4px 0 #1565c0; }
  .babBtn { background: #1e1e1e; border-radius: 12px; padding: 10px; color: #eee; border: 1px solid #333; cursor: pointer; min-width: 85px; font-size: 13px; }

  #wordBox { display: none; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; text-align: center; }
  #kanji { font-size: 20px; color: #888; margin-bottom: 5px; min-height: 24px; }
  #kanaWrap { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px; }
  #kana { font-size: 34px; color: #ff5722; font-weight: bold; }
  .speakerBtn { background: none; border: none; font-size: 28px; cursor: pointer; color: #ffb74d; padding: 5px; }

  #options { display: none; flex-direction: column; gap: 12px; width: 100%; margin-top: 20px; margin-bottom: 30px;}
  .optBtn { background: #252525; border: 1px solid #333; padding: 18px; border-radius: 15px; color: white; font-size: 18px; cursor: pointer; text-align: center; }
  .optBtn.correct { background: #4caf50 !important; border-color: #4caf50; }
  .optBtn.wrong { background: #f44336 !important; border-color: #f44336; }

  #inputContainer { display: none; width: 100%; flex-direction: column; gap: 10px; margin-top: 20px; margin-bottom: 30px; }
  #userAnswer { width: 100%; padding: 18px; border-radius: 15px; border: 2px solid #333; background: #252525; color: white; font-size: 18px; text-align: center; box-sizing: border-box; }
  #userAnswer:focus { border-color: #ff5722; outline: none; }
  #wrongMsg { display: none; color: #ffb74d; font-size: 14px; text-align: center; background: rgba(244, 67, 54, 0.1); padding: 10px; border-radius: 10px; border: 1px solid #f44336; }

  #resultPage { display: none; text-align: center; flex-direction: column; align-items: center; width: 100%; }
  .score-circle { width: 120px; height: 120px; border-radius: 50%; border: 6px solid #ff5722; display: flex; justify-content: center; align-items: center; margin: 20px auto; font-size: 30px; font-weight: bold; color: #ff5722;}
  #reviewBox { width: 100%; text-align: left; margin-top: 20px; max-height: 250px; overflow-y: auto; background: #1a1a1a; padding: 15px; border-radius: 12px; box-sizing: border-box; }
  .review-item { border-bottom: 1px solid #333; padding: 8px 0; font-size: 14px; }
</style>
</head>
<body>

<div id="app">
  <button id="backBtn" onclick="goBack()">‚Üê</button>
  <button id="muteBtn" onclick="toggleMute()">üîä</button>

  <div id="mainMenu" class="menu-container">
    <h2 style="color: #ff5722;">Êó•Êú¨Ë™û„ÇØ„Ç§„Ç∫</h2>
    <button class="mainBtn" onclick="showMinnaMenu()">MINNA NO NIHONGO</button>
    <button class="mainBtn iroBtn" onclick="showIrodoriMenu()">IRODORI</button>
    <div style="margin-top: 40px; text-align: center; border-top: 1px solid #222; width: 100%; padding-top: 20px;">
        <p style="font-size: 12px; color: #555;">Copyright ¬© 2026<br>Pengembang Cahya Ramadhan<br>Â§¢„ÅÆÈÅì„ÇØ„É©„Çπ</p>
    </div>
  </div>

  <div id="minnaMenu" class="menu-container">
    <button class="mainBtn" onclick="showBagian(1)">KOTOBA BAGIAN 1 (1-25)</button>
    <button class="mainBtn" onclick="showBagian(2)">KOTOBA BAGIAN 2 (26-50)</button>
    <button class="mainBtn" style="background:#333; border:2px solid #ff5722;" onclick="showRefMenu()">KOSAKATA REFERENSI</button>
  </div>

  <div id="irodoriMenu" class="menu-container">
    <h2 style="color:#2196f3;">IRODORI</h2>
    <button class="mainBtn iroBtn" onclick="startIrodoriKanji()">KANJI</button>
  </div>

  <div id="dynamicMenu" class="menu-container">
    <h2 id="dynamicTitle">Pilih Bab</h2>
    <div id="headerGrid"></div>
  </div>

  <div id="modeMenu" class="menu-container">
    <h2 style="color: #ffb74d;">Pilih Mode Kuis</h2>
    <p id="modeInfo" style="margin-top:-10px; color:#888;"></p>
    <button class="mainBtn" onclick="setQuizMode('jp-id')">JEPANG ‚ûú INDO</button>
    <button class="mainBtn iroBtn" onclick="setQuizMode('id-jp')">INDO ‚ûú JEPANG</button>
  </div>

  <div id="wordBox">
    <div id="quizHeader">
        <div id="quizInfo"></div><br>
        <div id="instruksi"></div>
    </div>
    <div id="kanji"></div>
    <div id="kanaWrap">
        <div id="kana"></div>
        <button id="mainSpeaker" class="speakerBtn" onclick="playAudio()">üîä</button>
    </div>
  </div>

  <div id="comboSection" style="display:none; text-align:center; margin-bottom: 10px;">üå±‚îÇ <span id="flowerCount" style="font-weight:bold; color:#4caf50;">0</span></div>
  
  <div id="options"></div>

  <div id="inputContainer">
    <input type="text" id="userAnswer" placeholder="Ketik jawabannya..." autocomplete="off">
    <div id="wrongMsg"></div>
    <button class="mainBtn" style="margin-top:10px; height:50px; font-size:14px;" onclick="checkInputAnswer()">KIRIM JAWABAN</button>
  </div>

  <div id="resultPage" class="menu-container">
    <h2 style="margin-bottom:0;">HASIL KUIS</h2>
    <div class="score-circle" id="finalScore">0%</div>
    <div id="finalDetail" style="color:#aaa;"></div>
    <div id="reviewBox"></div>
    <button id="nextChunkBtn" class="mainBtn" style="margin-top:20px; display:none;">LANJUT KUIS</button>
    <button class="mainBtn" style="background:#555; margin-top:10px;" onclick="goBack()">KEMBALI</button>
  </div>
</div>

<script src="data_minna.js"></script>
<script src="data_referensi.js"></script>
<script src="data_irodori.js"></script>

<script>
  let masterPool = [];
  let currentQuestions = [];
  let currentIndex = 0;
  let correctCount = 0;
  let combo = 0;
  let activeView = 'main';
  let currentLabel = '';
  let selectedData = null;
  let quizMode = 'jp-id';
  let currentAnswer = ""; 
  let wrongList = [];
  let isMuted = false;

  function hideAll() {
    ['mainMenu','minnaMenu','irodoriMenu','dynamicMenu','modeMenu','wordBox','options','comboSection','resultPage','inputContainer']
    .forEach(id => { document.getElementById(id).style.display = 'none'; });
  }

  function toggleMute() {
    isMuted = !isMuted;
    document.getElementById('muteBtn').innerText = isMuted ? 'üîá' : 'üîä';
    if(isMuted) window.speechSynthesis.cancel();
  }

  function showMainMenu() { hideAll(); document.getElementById('mainMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'none'; activeView = 'main'; }
  function showMinnaMenu() { hideAll(); document.getElementById('minnaMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'minna'; }
  function showIrodoriMenu() { hideAll(); document.getElementById('irodoriMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'irodori'; }

  function showGridMenu(title, type, start, end) {
    hideAll();
    const grid = document.getElementById('headerGrid');
    document.getElementById('dynamicTitle').innerText = title;
    grid.innerHTML = '';
    document.getElementById('dynamicMenu').style.display = 'flex';
    document.getElementById('backBtn').style.display = 'block';
    activeView = type;
    for(let i=start; i<=end; i++) {
        let b = document.createElement('button');
        b.className = 'babBtn';
        b.innerText = 'Bab ' + i;
        b.onclick = () => {
            selectedData = type === 'ref' ? referensiData[i] : babData[i];
            currentLabel = (type === 'ref' ? 'Ref Bab ' : 'Bab ') + i;
            showModeMenu();
        };
        grid.appendChild(b);
    }
  }

  function showBagian(n) { showGridMenu("Minna No Nihongo", 'bagian_'+n, n === 1 ? 1 : 26, n === 1 ? 25 : 50); }
  function showRefMenu() { showGridMenu("Kosakata Referensi", "ref", 1, 50); }
  function showModeMenu() { hideAll(); document.getElementById('modeMenu').style.display = 'flex'; document.getElementById('modeInfo').innerText = currentLabel; activeView = 'mode'; }

  function setQuizMode(mode) { quizMode = mode; startQuiz(currentLabel, selectedData); }

  function startQuiz(label, data) {
    if(!data || data.length === 0) { alert("Data kosong!"); return; }
    currentLabel = label;
    masterPool = [...data].sort(() => Math.random() - 0.5);
    nextChunk();
  }

  function startIrodoriKanji() { selectedData = irodoriKanjiData; currentLabel = "Kanji Irodori"; showModeMenu(); }

  function nextChunk() {
    currentQuestions = masterPool.splice(0, 10);
    currentIndex = 0; correctCount = 0; combo = 0; wrongList = [];
    activeView = 'quiz';
    renderQuestion();
  }

  function playAudio() {
    if (isMuted) return;
    const q = currentQuestions[currentIndex];
    if (!q) return;
    
    // Suara tetap selalu bahasa Jepang (diambil dari kana/kanji)
    let textToSpeak = q.kana || q.kanji;
    
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(textToSpeak);
    utterance.lang = 'ja-JP';
    utterance.rate = 0.8;
    window.speechSynthesis.speak(utterance);
  }

  document.getElementById('userAnswer').addEventListener('keypress', (e) => { if (e.key === 'Enter') checkInputAnswer(); });

  function renderQuestion() {
    if(currentIndex >= currentQuestions.length) { showResult(); return; }
    hideAll();
    const q = currentQuestions[currentIndex];
    const optBox = document.getElementById('options');
    const inputCont = document.getElementById('inputContainer');
    const inputField = document.getElementById('userAnswer');
    const speaker = document.getElementById('mainSpeaker');
    
    document.getElementById('wordBox').style.display = 'flex';
    document.getElementById('comboSection').style.display = 'block';
    document.getElementById('quizInfo').innerText = currentLabel + (quizMode === 'jp-id' ? " (JP-ID)" : " (ID-JP)");
    document.getElementById('instruksi').innerText = q.instruksi || "Pilih/Ketik jawaban yang benar";
    
    inputField.value = ""; inputField.style.borderColor = "#333";
    document.getElementById('wrongMsg').style.display = "none";
    optBox.innerHTML = '';

    let choices = [];
    if (quizMode === 'jp-id') {
        speaker.style.display = 'block'; // Tampilkan speaker di mode JP-ID
        document.getElementById('kanji').innerText = q.kanji || "";
        document.getElementById('kana').innerText = q.kana || "";
        currentAnswer = q.correct;
        choices = [...q.answers];
        setTimeout(playAudio, 300);
    } else {
        speaker.style.display = 'none'; // Sembunyikan speaker di mode ID-JP
        document.getElementById('kanji').innerText = ""; 
        document.getElementById('kana').innerText = q.correct; 
        currentAnswer = q.kana;
        choices.push(q.kana);
        let others = selectedData.filter(item => item.kana !== q.kana).sort(()=>Math.random()-0.5).slice(0,3);
        others.forEach(o => choices.push(o.kana));
    }

    const isTyping = Math.random() > 0.5;
    if(isTyping) {
        inputCont.style.display = 'flex';
        inputField.focus();
    } else {
        optBox.style.display = 'flex';
        [...choices].sort(()=>Math.random()-0.5).forEach(txt => {
            let b = document.createElement('button');
            b.className = 'optBtn'; b.innerText = txt;
            b.onclick = () => processAnswer(txt === currentAnswer, b);
            optBox.appendChild(b);
        });
    }
    document.getElementById('flowerCount').innerText = combo;
  }

  function checkInputAnswer() {
    const q = currentQuestions[currentIndex];
    const userVal = document.getElementById('userAnswer').value.trim();
    const msg = document.getElementById('wrongMsg');
    const inputField = document.getElementById('userAnswer');
    
    let isCorrect = (quizMode === 'jp-id') ? 
        (userVal.toLowerCase() === q.correct.toLowerCase()) : 
        (userVal === q.kanji || userVal === q.kana);

    if(isCorrect) {
        inputField.style.borderColor = "#4caf50";
        processAnswer(true);
    } else {
        inputField.style.borderColor = "#f44336";
        msg.style.display = 'block';
        msg.innerText = (quizMode === 'jp-id') ? `Salah! Jawaban: ${q.correct}` : `Salah! Jwb: ${q.kanji || ''} (${q.kana})`;
        setTimeout(() => processAnswer(false), 2500);
    }
  }

  function processAnswer(isCorrect, btn = null) {
    const q = currentQuestions[currentIndex];
    if(isCorrect) {
        if(btn) btn.classList.add('correct');
        correctCount++; combo++;
        playAudio(); // Suara bunyi setelah jawaban benar
    } else {
        if(btn) btn.classList.add('wrong');
        wrongList.push(q); combo = 0;
        if(btn) {
            Array.from(document.getElementById('options').children).forEach(b => {
                if(b.innerText === currentAnswer) b.classList.add('correct');
            });
        }
    }
    setTimeout(() => { currentIndex++; renderQuestion(); }, (isCorrect ? 800 : 1200));
  }

  function showResult() {
    hideAll();
    document.getElementById('resultPage').style.display = 'flex';
    let p = Math.round((correctCount/currentQuestions.length)*100);
    document.getElementById('finalScore').innerText = p + "%";
    document.getElementById('finalDetail').innerText = `Selesai: ${currentLabel}\nSisa di tumpukan: ${masterPool.length}`;
    
    const reviewBox = document.getElementById('reviewBox');
    reviewBox.innerHTML = '<b>Review Kata Salah:</b><br>';
    if(wrongList.length === 0) reviewBox.innerHTML += '<span style="color:#4caf50">Tidak ada kesalahan! Hebat!</span>';
    else {
        wrongList.forEach(w => {
            reviewBox.innerHTML += `<div class="review-item"><b>${w.kanji || ''} ${w.kana}</b><br>Artinya: ${w.correct}</div>`;
        });
    }

    const btnLanjut = document.getElementById('nextChunkBtn');
    if (masterPool.length > 0) { btnLanjut.style.display = 'block'; btnLanjut.onclick = nextChunk; }
    else { btnLanjut.style.display = 'none'; }
  }

  function goBack() {
    window.speechSynthesis.cancel();
    if (activeView === 'quiz' || activeView === 'result') showModeMenu();
    else if (activeView === 'mode') {
        if(currentLabel.includes("Ref")) showRefMenu();
        else if(currentLabel.includes("Kanji")) showIrodoriMenu();
        else showBagian(parseInt(currentLabel.replace("Bab ","")) <= 25 ? 1 : 2);
    } 
    else if (activeView.startsWith('bagian') || activeView === 'ref') showMinnaMenu();
    else showMainMenu();
  }

  window.onload = showMainMenu;
</script>
</body>
</html>
